■ 7-zip 自動化ツール

● 概要

　7-zip を利用して、フォルダ以下に対するzip圧縮を自動化するためのツールです。
　ツールの実行にはzip定義ファイル(*.zipping)を準備して、それを実行します。
　圧縮対象を設定することで必要なファイルのみ圧縮できます。
　つまり、プリコンパイルヘッダなどの中間ファイルを除外してソースコードのみをバックアップできます。

　ant などでも同様のことが可能ですが、これを使えば色々な環境設定が不要になります。

● インストール方法

　０．7-zip をインストールしておきます。
　１．インストールフォルダを準備します。
　２．インストールフォルダに配布用のzipファイル（例、zipping.20120509.101021.zip）をコピーします。
　３．zipファイルを7-zipで「ここに展開」します。
　４．解凍された zipping.wsf を実行します。

　Vista以降の場合はUACでの実行確認が出ますので、許可してください。
　レジストリにzip定義ファイルなどの情報を書き込むため、管理者として実行する必要があるためです。

　★ 注意 ★
　インストール直後には、インストール以前に実行されたエクスプローラにはメニュー設定は反映されていません。
　エクスプローラを新規起動するなり、Windowsを再起動するなりしてください。

● アンインストール方法

　インストールフォルダにある「zippingツールのアンインストール」ショートカットを実行します。
　インストールと同様にVista以降の場合はUACでの実行確認が出ますので、許可してください。

● 利用方法

　１．圧縮対象のフォルダをエクスプローラで開きます。
　２．フォルダで右クリックしてコンテキストメニューを開きます。
　３．メニューの下のほうにある新規作成により「zip定義ファイル」を作成します。
　４．zip定義ファイルに必要なファイルのための設定を記述します。

　５．zip定義ファイルをダブルクリックなどで実行します。

　　　実行ログ、zipファイル、圧縮ファイル一覧の３個の出力ファイルができます。
　　　それぞれ、圧縮した日付時刻がファイル名に自動的に付与されます。
　　　zipファイル、圧縮ファイル一覧のファイル名は定義ファイルの指定によります。

　　　しかし実行ログは、定義ファイルが間違っていた場合などにも作成されます。
　　　そのため定義ファイルのフォルダに定義ファイル名を元に実行ログは作成されます。
　　　たとえば「定義.zipping」の場合は「定義.zipping.<日付時刻>.log」となります。

● zip定義ファイル(*.zipping)の書き方

　zip定義ファイルはXML形式のテキストファイルです。

    <?xml version="1.0" encoding="UTF-8" ?>
    <project name="zipping" zippath="zip">
        <include name="**/*.vbs"/>
        <include name="**/*.wsf"/>

        <include name="*.bmp"/>
        <include name="*.ico"/>

        <include name="sample/*"/>

        <include name="*.txt"/>
        <include name="*.zipping"/>

        <exclude name="lab/**"/>
    </project>

　project要素の中にはinclude要素とexclude要素のみ入ります。

◎ <project name="zipping" zippath="zip">

　name プロパティはzipファイル、圧縮ファイル一覧を識別するための指定です。
　たとえば <nameプロパティ>.<日付時刻>.zip というようなファイル名になります。

　zippath プロパティは、zipファイル、圧縮ファイル一覧の保存先です。
　フォルダがなかった場合には自動的に生成します。

◎ <include name="**/*.vbs"/>、<exclude name="lab/**"/>

　定義ファイルを基準としたサブディレクトリのファイルのパスに対するパターンマッチングです。
　include要素は圧縮対象を指定し、excludeは除外対象を指定します。
　exclude要素が優先されるだけで、nameプロパティの指定方法は同一です。

　"*" は、'/' を含まない任意の文字列、ワイルドカードです。
　"**" は、'/' も含みます。その間にいかなるパスがあったとしてもマッチします。

　exclude要素が優先されるとは、上記例で説明するなら、"lab/*.vbs" はどちらにも当てはまります。
　しかし、exclude要素が優先されるため除外対象となります。

（以上）
